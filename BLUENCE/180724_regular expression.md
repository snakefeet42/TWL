# 180724 _ 정규표현식 #1,2 애란쌤



**꿀 TIP**  : 모든 데이터를 한번에 돌리려면 너무 시간이 오래걸리니까 

일단 대표성을 띄는 샘플링을 뽑아서 그걸로 고치고 고치고 해서 

조금씩 샘플을늘려보면서 해보고 어느정도 완벽하면 그 다음에 전체데이터를 돌린다. 

컴퓨터를 놀게 하지마세요. 피드백을 최대한 빠르게 받기 위해 노력해주세요! 

https://medium.com/@originerd/%EC%A0%95%EA%B7%9C%ED%91%9C%ED%98%84%EC%8B%9D-%EC%A2%80-%EB%8D%94-%EA%B9%8A%EC%9D%B4-%EC%95%8C%EC%95%84%EB%B3%B4%EA%B8%B0-5bd16027e1e0



**꿀TIP2** : 우선 매칭되어야 하는것을 적고, 매칭되면 안되는 것을 적고 

이 사이트에서 제대로 일어나는지 확인하면서 (테스트하면서) 하면 좋습니다! 

 https://regex101.com/

~~~
\b[1-9]\d{0,2}(,\d{3})*원.+손해

\w[\w+.]*@\w+(.\w+)+  # 이메일 잡아내기 
~~~



**should match :** 

나는 5원을 손해봤다
나는 5,000원을 손해봤다.
나는 50원을 손해봤다.
나는 500원을 손해봤다.

**should not match:**

5,00원을 손해봤다.
나는 삼각형, 비타5,원을 손해봤다. 

**Nice to have :**

5백만원을 손해봤다.



## 배운 내용들을 어떻게 분류할까 ? 

- 파이썬 문법 

- 라이브러리 : numpy, pandas, scipy

- 파이썬 안에서 실행되는 '미니 언어'들

  - 특정 함수의 인자로 특정 형식의 문자열을 넘겨주면 무언가가 실행된다.
  - CSS 셀렉터: beautifulsoup.select(“body > .list > li”)
  - 정규표현식: re.match(r”(\d+-\d+-\d)”)

- 알고리즘과 자료구조 (나중에 중요해진다)

  - 파이썬 문법과 라이브러리와 미니 언어를 잘 활용하여 컴퓨터한테 내가 원하는 일을 일을 효율적으로 시키기 ex) 셔플 알고리즘을 만들어도 어떻게 하면 효율적으로 만들까 ? 

- **확률/통계 (중요)** **실험설계와 평가를 제대로 하려면 반드시 잘 이해하고 있어야 합니다!**

  - 세상에서 일어나는 현상을 정량적으로 이해하기 
  - 알려진 정보를 근거로 알려지지 않은 정보를 추측하기
  - 이를 바탕으로 합리적인 의사결정 하기 
  - 의사결정에 따른 실행 결과를 정량적으로 평가하기 

- 확률/통계와 프로그래밍의 관계



## 실무 이야기 (A/B 테스트 이야기 == RCT: Randomized Controlled Experiment) 

- 온라인 쇼핑몰 기획전 ( 오늘마감, 특가, 신상모음등..)
  - 홈페이지 쇼핑몰 A,B,C 메인으로 만들고 동전을 던져서 임의로 동일한 기간동안 만명씩 방문하게 한다. 
- 게임 맵 관련 테스트
- H0 (귀무가설; null hypothesis): 두 디자인이 구매전환율에 미치는 영향이 없다.
- H1 (대립가설; alternative hypothesis): 새 디자인의 구매전환율이 더 높다. (one-sided test)
- Type I Error: 영향이 없는데 있는 것으로 판명하는 오류 (false positive)
- Type II Error: 영향이 있는데 없는 것으로 판명하는 오류 (false negative)

=> 보통은 Type 1이 더 위험하다고 판단하지만 맥락에 따라 다릅니다. 

=> 화재경보기 같은경우에는 false positive 에 더 민감하게 설계한다. false negative가 안나오게 하기 위해..



- **통계적으로 유의미한 차이(statistically significant difference)란? **

  **(1) P-value**

  H0이 맞다고 가정했을때 나오기 힘든 결과가 나왔다면 통계적으로 유의미. “나오기 힘든"이란? 100번 했을 때 5번 나올까 말까 한 정도(p < 0.05)의 그러한 결과가 나왔다면…

  1) H0이 맞지만 우리가 방금 엄청난 우연을 목격했다. 2) 아마 H0이 틀렸을 것이다.

  p가 점점 작아질 수록 널가설이 틀릴 가능성이 높다. 

  

  **(2) effect size (효과크기) 가 얼마나 되는지도 판단필요**

  실제로 비즈니스에서 0.1% 전환율 상승이 일어났을 때 얼마나 늘어나는것인가? 



## 과제피드백 

- 국민청원 크롤러 참고 : https://github.com/akngs/petitions/blob/master/petition.py

- 좁은 보폭으로 각 단계를 확인하며 코딩을 하면 훨씬 좋습니다. print문을 찍고 잘 들어갔나 확인하고 하세요 

  ex) len(index) == len(category) == len(title) == len(votes)

- 서로의 해결책을 공유하기, 다른 사람의 해결책에서 힌트 얻기, 크래딧 명시하기 문화를 장려

- 박소현님, 정예인님, 김예은님: 첫 페이지에서 가장 최근 글 번호 뽑아내서 활용하기. 

  1) 언제 실행하더라도 잘 동작, 2) 매직 넘버 제거

- “삽질” 기록 남기기. 잘 만든 코드를 공유하는 것도 좋지만 본인이 어떤 부분에서 어려움을 겪었는지 공유하는 것도 매우 유용. (프로젝트 실패 후 실패 과정을 잘 정리해서 공유했더니 보너스 받은 적 있음)정지은님 → “처음에 삽질했던 내용”

- **최대한 자주시도하고, 최대한 빨리 망하고, 수도 없이 망할 걸 권유합니다.** 

- 셀렉터와 칼럼 이름만 정해주면 데이터를 추출하는 함수 구현.mark("div.bl_no", "번호")

- 될 수 있으면 함수로 쪼개놔야 변수명이 겹쳤을 때 문제가 안일어 납니다!

바탕화면에 늘어놓기보다 서로다른 폴더를 여러개 만들어놓으세요. 

----



## 정규표현식 (regular expression) 

- 패턴을 정의하는 언어
- 구글 문서, 워드, 엑셀, 파이썬, 자바, 자바스크립트 등 어디에나 있음
- 해석할때는 무조건 앞에서부터 뒤로 한글자씩 가면서 후보군을 추려나가는 방식이다!

정규표현식 1.  https://docs.google.com/document/d/1H8MUTPI2SQ-sarHHAtuMoEevh1XW65pv7IP43ZEAeP8/edit



정규표현식 2. https://docs.google.com/document/d/1wfZnhEq6069AhrV9R6Rak8q6IWk9Yzo_TEgR9l4clCA/edit#



 https://colab.research.google.com/drive/1GcbbzgrBbzfmxDAuTfB6PJAN44akORg-#scrollTo=hDUNoJ2FNQAq



- 정규표현식 실습 사이트 : https://regex101.com/

-  src = " " 이렇게 받아오고 나면 복사본 만들기 

  df = src.copy()

- 결측치가 있는 행은 제거

  df = df.dropna()

  

- 18가지 패턴 한번에 찾기 

~~~
df.loc[df['content'].str.contains('(중|고등)(학교)?\s?[123]', regex=True)]
~~~

중 또는 고등 나오고 

학교가 나오거나 안나오거나

한칸띄거나 안띄거나

123은 숫자 123중에 하나 나오는 것 



돈에 해당하는 것 전부 찾기 

~~~
df['content'].str.extractall('([\d,]+원)')
~~~



숫자만 한번에 뽑기 

~~~
import re

int(re.sub('\D', '', "정가 15,300원")) 
~~~





* 역슬래시가 필요한 이유 

파이썬에서  역슬래시를 2번 하면 역슬래시 1개를 표현하는 것과 같음 



- 정규표현식에서의 의미 

\d => 숫자 1개 

\d\d => 숫자 2개 

\D => 숫자 아닌것 

\s = 공백

- 파이썬에서 정규표현식의 숫자를 나타내려면 ? 역슬래시를 2번 쓰거나 r (raw string) 사용

~~~
r"\d"  = "\\d" 
~~~

raw string을 쓰면 역슬래시를 한번만 하면 된답니다! 



- sep[ae]r[ae]te : 오탈자 모두 찾아내기 

separate
seperate
separete





- extractall 을 쓰려면 ( ) 괄호를 써야 합니다.  왜죠? 괄호는 캡쳐 역할을 합니다. 

- extracall 의 괄호는 캡쳐해준다 ( 괄호안에 들어있는 부분만 뽑아낸다)

  괄호는 . 찾기는 끝까지 찾아도 괄호 안에까지만 캡쳐해준다. 

ex ) df['content'].str.extractall(r'(이\S\S)[씨님]') 

검색은 이지은님 까지 찾지만 뽑아낼때는 괄호안에 있는 이지은까지만 뽑는다.



- 원을.+손해 

  원을 나오고 아무글자 한개 나오고 앞에 쭉나오다가 (+) 손해나오면 찾는다. 



\b : 경계가 뭔가 하나 들어가면 ) ( /  뭔가 이런것... 

.{1,10} : 아무거나 한개 1~10개 사이 

- 전화번호 찾기 사진 찍음 







----



## 컴퓨터는 한글을 어떻게 처리하나? 

유니코드 테이블을 통해 은/는/이/가를 자동으로 붙여주는것이 가능합니다. 

 (한국어 조사 처리 함수도 있음! )

https://taegon.kim/archives/4776

유니코드를 부호화하는(인코딩하는) 방식중에 UFT-8 이라는 것이 있다. 

영미권해당하는 것들은 아스키코드와 유사하게 짧게 저장시켜주고, 한글은 좀 더 길게...



정규표현식의 패턴을 이해하기 어려울 때 참고하면 아주 좋은 사이트! 

- 정규표현식 시각화 해보기 : https://regexper.com/



## 정규표현식이란 ?

- Regular language 의 문법을 기술하는 표현식 . 그래서 정규표현식.
- 형식언어란?  (유한한 알파벳 + 문법을 기술하는 유한한 규칙) < -- > 자연어  (규칙없기도함)
- 정규언어는 전화번호나 이메일형식같이...



- Finite state automaton 이라는 기계로 나타낼 수 있는 인공언어(의 변형). 

​      가장 단순한 인공언어 (Chomsky hierarchy type 3)

촘스키위계가 유명한건가요? 

- **두 전통이 싸우고 있다 : 구글의 peter norvig  vs chomsky**  

GOTAI : 최대한 논리적으로 일하는듯한 기계를 만들어내는 것 (정규표현식은 여기에 가까움)

ANN : 인공지능

- 촘스키 행동주의 비판!! 

" 미국언어권에서 태어난 아이가..택도 없이 적은 글을 들어도 말을 한다! "

" 이걸 설명하려면 인간은 처음부터 타고 태어난다! "





정규표현식 + 기술할 수 없는것 예외들은 신경망을 때려박아서...섞어서 쓰자..

- noam chomsky : 현대 언어학의 아버지 

----

## 정규표현식 간단한 정리 

파이썬에서 활용하기:

- **파이썬 str에서** 정규식으로 찾아바꾸기

import re
re.sub('\d{3}-\d{3,4}-\d{4}', text)



- **판다스 DataFrame에서** 정규식으로 정보 추출하기

df['content'].str.extractall(r'([중고][1-3])') 



- **판다스 DataFrame에서 정규**식으로 찾아 바꾸기

df['content'].str.replace(..., regex=True)



일반 문자열

"문재인": 문 → 재 → 인

메타캐릭터: ^, $

"^문재인": 문장의 시작 → 문 → 재 → 인

이스케이프 (escape): \

"\$500": $500
"\^\^": ^^

캐릭터 클래스: [...]

"[초중고]3": (초 또는 중 또는 고) → 3
"sep[ae]r[ae]te" 
df['content'].str.extractall(r'([중고][1-3])')

캐릭터 클래스 메타캐릭터: [1-3]

"[중고][1-3]": 중1,중2,중3,고1,고2,고3

메타캐릭터 (추가): ., \d, \D, \s, \S

"이\S\S[씨님]": 이재명씨, 이재명님, 이선희님, 이이이씨 (공백 아닌 글자 한 개)
"\s" → 공백(스페이스, 탭 등 온갖 공백) 글자 한 개
"\d\d월 \d\d일": 12월 23일 (아무 숫자 한 개)
"." → 아무 글자 한 개
퀴즈: 본문 중 언급되는 전화번호 모두 찾아내기
퀴즈: 본문 중 언급되는 전화번호를 모두 ***-****-**** 형식으로 대체하기

얼터레이션 (alteration): (...|...|...)

"(존경|친애)하는": 존경하는, 친애하는 //  (    ) 이거 할 때는 바로구분! [ ] 와는 달리 여러글자를 함께 사용가능! 

양화사 (quantifier): ?, *, +, {2}, {2,5}

?: 0개 or 1개 / 앞 글자가있거나 없거나 상관없음
*: 0개이상 / 앞에 해당하는 글자가 0개이상이면 검색해줌  
짱*  => 짱없거나 / 짱짱 / 짱짱짱짱 / 짱 모두 검색해줌
+: 1개이상

"(존경|친애)하옵?는": 존경하는, 존경하옵는, 친애하는, 친애하옵는 (0개 혹은 1개)
"ㅋ+": ㅋ, ㅋㅋ, ㅋㅋㅋ, ㅋㅋㅋㅋ, … (1개 또는 그 이상)
"이다ㅋ{3}": 이다ㅋㅋㅋ (정확히 3개)
"(너무){2,3}": 너무, 너무너무, 너무너무너무 (2개에서 3개 사이)

ex) 휴대폰번호 : 010 -\d{3,4}-\d(4) : 가운데자리수가 3개 혹은 4개인경우 매칭가능

Capture groups: (...)

df['content'].str.extractall(r'([김이박최강맹정]\S\S)[씨님]'): 전체를 기준으로 찾은 후 괄호 안에 있는 부분만 잡아서(capture) 뽑아내기

re.sub(r'010-(\d\d\d\d)-(\d\d\d\d)', r"82-10-\1-\2", '010-1234-5678'): 전화번호에 국가번호 추가하기



**모호성 문제 : Greedy vs. Non greedy**

- Greedy   .+\.

안녕하세요. 반갑습니다.

Greedy하게 최대한 욕심을 내서 가서 문장의 끝까지 가서 찾는다. 

-  Non greedy  .+?\.

안녕하세요. 반갑습니다.  

- w : _ , 영어, 숫자 이런것 받는다. 



-----



## 아직 이해 X

**캡쳐그룹은 왼쪽부터 훑다가 첫번째 ( 이거에서 1번 캡쳐,**

df['content2'] = df['content'].str.replace(r'([김이박강최맹정전지])\S\S([님씨께])', r'\1땡땡\2')

df['content2'].str.extractall(r'([김이박강최맹정전지]\S\S[님씨께])')



